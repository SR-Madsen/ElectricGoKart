/*
 * xadc.c
 *
 *  Created on: Apr 29, 2021
 *      Author: sebastian
 */

#include "xadc.h"

/*
 * 	Examples of use
 */

/*


*/


/*
 * 	Functions
 */
// See header file for documentation

// Initialization of XADC.
u8 initXADC() {
	u8 status;

	XAdcConfigPtr = XAdcPs_LookupConfig(XADC_DEVICE_ID);
	if (XAdcConfigPtr == (XAdcPs_Config *) NULL) {
		xil_printf("XADC Config lookup failed");
		return XST_FAILURE;
	}

	// Initialize XADC from configuration
	status = XAdcPs_CfgInitialize(&XAdc, XAdcConfigPtr, XAdcConfigPtr->BaseAddress);
	if (status != XST_SUCCESS) {
		xil_printf("XADC Initialization failed");
		return XST_FAILURE;
	}

	// Do selftest of BRAM module to check that it's functional
	status = XAdcPs_SelfTest(&XAdc);
	if (status != XST_SUCCESS) {
		xil_printf("XADC Selftest failed");
		return XST_FAILURE;
	}

	return XST_SUCCESS;
}

void getBatteryRaw(u16 *raw);
void getTorqueRaw(u16 *raw);
void getPhaseARaw(u16 *raw);
void getPhaseBRaw(u16 *raw);

// Get data from auxiliary channel conversion
u16 getXAdcAuxData(u8 channel) {
	return (XAdcPs_GetAdcData(&XAdc, XADCPS_CH_AUX_MIN + channel) >> 4);
}
